* Changes in PhEDEx 3.0.0

  This release is a mandatory upgrade. The main changes with respect to the
  pre-release series are a number of minor fixes and enhancements.

* Changes in the FTS backend
   - option to specify the maximum number of active files per link
   - options to pass the name of a myproxy server, an FTS password file,
     or an SRM spacetoken, to the FTS server.
   - job-state is saved and recovered across agent restarts
   - improvements to the logging, making more relevant information available.
   - verified that the SRM backend was not broken by these changes

* Changes in PhEDEx 3.0.0.pre13

   - Fixed a bug with the wrong version of FTS.pm in pre12.

* Changes in PhEDEx 3.0.0.pre12

Changes for All Agents
   - minor typos/bugfixes w.r.t. 3.0.0.pre7 corrected.
   - other agents which had not yet been 'consolidated' have been split out
     into separate modules, so at least the basic consolidation is done. This
     is to allow the possibility to run them all as multiple-agents per
     process, rather than having some still requiring their own process just
     because we hadn't split out the modules

* Changes in PhEDEx 3.0.0.pre7

Changes for All Agents
   - new Agent infrastructure based on the Perl Object Environment 
     (http://poe.perl.org/). This introduces a new dependency and a new
     RPM is provided to satisfy it. Installation should proceed normally.
   - not all agents are using the POE framework yet, there is a
     POEAgent.pm for those that do. POEAgent.pm should be a drop-in
     replacement for Agent.pm for all agents, this simply hasn't been
     tested everywhere yet.
   - running multiple agents in a single process is now possible with no
     changes to the agent beyond using the POE framework. Agents in the 
     same process can share a database connection or not, configurable on 
     a per-agent basis. Configuration-file syntax is compatible with 
     existing syntax, only the semantics change. We are testing this at 
     CERN, documentation will follow.

Changes for Site Agents
   - new FTS backend. This is a significant re-write of the original. The
     SRM backend is unchanged. The new agent is in 
     Toolkit/Transfer/FileDownload2, this is a temporary measure until it 
     is fully tested. It has the following features:
    - per-link monitoring of transfers, with statistics and an 'isBusy'
      function calculated per link. This makes it practical to once again
      run only one FileDownload agent per site, instead of one per link.
    - asynchronous file-based monitoring, not synchronous job-based. FTS
      servers are monitored at a fixed rate, independant of the number of
      jobs submitted, so the FTS server will never be overloaded.
    - per-file and per-job callbacks allow the FTS backend to react to 
      state changes as soon as they become known, not only after job 
      completion.
    - number of jobs is no longer an inflexible limit. The process uses 
      the actual link-state to determine if it is safe to submit more
      transfers.
    - eliminates use of transfer-wrapper and ftscp scripts, which will
      greatly reduce the number of processes running on a busy vobox.
    - uses the POEAgent infrastructure.

Unfinished features
   - FTS backend
    - the FTS backend does not support SRM yet.
    - nor does it remember jobs in the queue across stop/restarts
    - some effort is doubtless needed for optimisation
   - SRM backend
    - need confirmation that we haven't broken anything.
   - Multiple agents per process
    - agent-reporting in the Component::Status page is not yet perfect.
    - better monitoring is needed to make sure that one agent does not 
      starve another for CPU (POE is cooperative multi-tasking, not 
      pre-emptive)

* Changes in PhEDEx 2.6.3

Bug Fixes For Central Agents
   - BlockDLSUpdate: Fix bug in update of deleted blocks which
     resulted in them not being reported to DLS

Changes for Site Agents / Tools
   - TMDBInject: Fix problem where some character data was injected as
     type NCHAR, resulting in extremely slow injections
   - InspectPhedexLog: extended date regexp, minor changes in output
     (per site rates, better formatting)
   - BlockConsistency: Fix forced expiry which prevented tests from
     being performed
   - BlockDownloadVerify-report.pl: provide sensible default for age,
     update help
   - StorageConsistencyCheck: added an option to check an LFN list
     against the replicas in a given storage element
   - Master: on 'stop', wait for processes to be terminated before
     exiting

T0 / CAF
   - Special code for supporting the CAF transfers added:
     Utilities/stagercp, Utilities/wrapper_rfcp,
     PHEDEX::Transfer::Stager
   - BlockDBSPopulate added: New agent that migrates blocks to a
     target DBS (usually local) once the block is completely
     transferred to node (SE).

Et Cetera
   - Toolkit/DBS/DBSInvalidateFile: Added option to change the status
     of a whole block 
   - Toolkit/DBS/DBSMigrateDataset added: Helper script to migrate a
     dataset between DBSes



* Changes in PhEDEx 2.6.2

Bug Fixes for Site Agents
   - Fixed the "misconfigured -accept" bug in FileDownload, which
     caused a locking of the entire system if an -accept or -ignore
     flag contained nodes which do not exist in the databaes.
   - Bad -nodes, -accept, or -ignore arguments are now a fatal error,
     killing the agent
   - Better argument checking for state and logfile directories,
     missing directories are now a fatal error

Changes for All Agents
   - PHEDEX_DEBUG environment variable can be switched on to turn on
     DEBUG output for agents.  For all agents one will at least be
     able to see the cycle time (for idle()) and sleep time printed to
     the logs.
   - PHEDEX_VERBOSE environment variable can be switched on, for
     future use.  Most agents don't have special verbosity levels at
     this time.

New Features for Central Agents
   - Block latency logging done by BlockAllocator

Bug Fixes for Central Agents
   - BlockDelete ensures distinct results from move-triggered deletions


* Changes in PhEDEx 2.6.1
   - No changes; just a fix to the dependencies configuration



* Changes in PhEDEx 2.6.0

Code Consolidation
   - BlockActivate, BlockDeactivate, BlockMonitor, BlockAllocator,
     BlockDLSUpdate split into perl modules
   - Toolkit/Common code depreciated, all dependent code now uses
     PHEDEX::Core::* library

New Features for Site Tools
   - ftscp updated for use with SRM v2.2 (-token option added)
   - Custom/Template/FileDownloadSRMVerify updated for use with SRM
     v2.2 (make option -d compatible)
   - Utilities/StorageConsistencyCheck and Utilities/BlockConsistencyCheck
     work with single LFNs or lists of LFNs from the command line.

Bug Fixes for Site Tools
   - Master can now be called from an absolute path
   - FileDownload purges tasks before filling backend, as an
     optimization
   - Remove -accept and -ignore options from FileRemove, which are
     uneccessary
   
Schema and Central Agents
   - BlockMonitor works in groups of blocks, saving memory
   - BlockDeactivate works in groups of blocks and deactivates more
     frequently than before
   - Fixes in BlockDeactivate mean LoadTestCleanup will be more
     effective

Dependencies
   - Dependency on srmcp package removed, new v2 srmcp package to be
     made available as a separate install
   - dls 1_0_3 -> dls-client 1_0_4



* Changes in PhEDEx 2.5.4.2

New Features for Site Tools
   - /Toolkit/Transfer/FileRemove changes
        - New '-limit' option limits file deltion attempts per minute.  The default is 100.
        - Delete TMDB replica information from buffer node when deleting for an MSS node.
   - Utilities/Master: rewritten according to Consolidation project 
     guidelines, including POD documentation.
     The changes are fully backwards-compatible, with a few new features:
        - use '--dummy' on the command-line to get a printout of the action, for 
          all actions (not just 'start')
        - use the 'jobcount' command to get the total number of jobs that will 
          be run in a given configuration.
   - Utilities/BlockDownloadVerify-report.pl now offers filters on age of the 
     reported test and on block-name

Schema and Central agents
   - Toolkit/Verify/BlockDownloadVerifyInjector now cleans t_dvs_files for 
     very old checks, to prevent the table growing too big.
   - Toolkit/Workflow/BlockAllocator and Toolkit/Workflow/BlockDelete
     completely rewritten:
       - Improved logging messages about work that was done
       - Bugs in handling of deletions/moves fixed
       - Moves are now always done on the block level.  Moves of datasets
         trigger deletion of the source blocks when the replication is complete.
       - Moves now only remove source blocks for sources with no
         subscription.  Web interface handles the request and removal
         of the source subscription.
       - Moves will not delete data from a T1.
       - Moves "expire" 1 week after replication is done.  Finished or
         expired move subscriptions automatically turn into replica
         subscriptions.
   - Rewritten schema for web requests

* Changes in PhEDEx 2.5.4.1

 New Features for Site Tools
   - BlockDownloadVerify agent released for the first time. Only namespace
     checks for size of files and migration at castor-sites for now, plus
     a placeholder for DBS checking, to follow soon
   - BlockDownloadVerify and associated tools moved to new PERL module
     structure. PERL5LIB must be set correctly, the RPM installation 
     should take care of this automatically
   - InspectPhedexLog expired transfers are no longer counted for
     success rate.  Added options to inspect files with multiple
     failures (-m flag) this helps to identify reasons for long
     transfer tails external to the PhEDEx algorithms (resource
     related problems)

 Schema and Central agents
   - BlockDLSUpdate and BlockDownloadVerifyInject now both trigger 
     insertion of test-requests, either on block-closure (BlockDLSUpdate) 
     or when files are not moving on the LAN or WAN 
     (BlockDownloadVerifyInject)
   - LoadTestInject agent now only throttles injections when there is
     enough data to transfer at the rate for 6 hours
   - BlockDLSUpdate agent remembers successfully issued dls-add
     commands and does not re-execute them every cycle.  Additionally,
     log output is reduced by only saving one log file per SE name /
     block ID pair instead of one logfile per error (timestamped).
   - BlockDLSUpdate now uses routines from the BlockDownloadVerify::Core
     module, so it too needs PERL5LIB to be set up correctly

 Bug Fixes
   - InspectPhedexLog fix for start/end dates when running over multiple logs

* Changes in PhEDEx 2.5.3.6

 New Features for Site Tools
   - No changes wrt. PhEDEx 2.5.3.5
   
 Schema and Central agents
   - FileIssue does destination-match instead of remote-match for TFC rules
   
   - FileRouter random probing fixed for case where link is of the worst 
     possible quality
 
   - Centralised LoadTest injection and management added

 Operator's Tools:
   - No changes wrt. PhEDEx 2.5.3.5
 
 Bug Fixes
   - No changes wrt. PhEDEx 2.5.3.5 

* Changes in PhEDEx 2.5.3.5 

 New Features for Site Tools
   - LoadTest07Inject now packaged with PhEDEx and with new features with 
     respect the other versions floating around.  This version by default 
     closes blocks once they reach the user-specified file limit (default 
     100) and marks datasets as "transient". This allows the blocks to 
     collapse when they are finished and another agent (LoadTestCleanup) 
     will incrementally clean up finished blocks.    

   - New LoadTest file creation scripts
   - Addition of FileMSSMigrate agent, which combines separate backend 
     scripts (Castor, dCache) for file migration into one agent. This is 
     now the officially supported way of running a migration agent.
   - Template of FileDownloadSRMVerify added code compatibility with SRM 
     2.2 systems

   - InspectPhedexLog
     - Canceled/Expired files treated seperately.
     - Simple histograms on per error class basis

 Schema and Central agents
   - FileRouter more strictly enforces transfer window limits
   - FileRouter now fills priority windows to WINDOW_SIZE per priority 
     level.  WINDOW_SIZE can be specified by a command-line argument
   - FileRouter observes the 'is_active' column in the links table, 
     allowing us to enable and disable links easily
   - FileCastorStager.New is renamed to FileCastorStager. There is no 
     FileCastorStager.New anymore!

 Operator's Tools:
   - FileDeleteTMDB is made more robust, with optional bulk deletion and 
     easier to use block-expansion
   - DDTLinkManage for enabling and disabling links
   - BlockConsistencyCheck code cleaned up, SQL improved, some output
     moved to STDERR to keep STDOUT cleaner, online help improved.

 Bug Fixes
   - Minor documentation updates in tools and agents
   - FileDownload does a sanity check for node existence in the DB

* Changes in PhEDEx 2.5.3.4

 Schema and Central agents
   - FileRouter now keeps a status table of paths from source to
     destination, aggregated per block.  These statistics will be
     available via the web and can show current routing status as well
     as the number of transfer attempts per block and the time a block
     has been waiting to be transferred.
   - FileRouter no longer writes multi-WAN-hop paths to the DB.
   - InfoStateClean now keeps 100 recent errors by link

 New Features for Site Tools
   - ftscp: Added the ability to specify MyProxy server by adding flag
     '-m=myproxy-fts.cern.ch'. Made -passfile optional, to adapt to
     passwordless proxy delegation mode of FTS2.0
   - BlockConsistencyCheck: Allow explicit Migration check, as opposed
     to implicit check by selecting SE. Better printout. Support LFN
     and autoBlock options.

 Bug Fixes
   - ftscp: Fixed a small bug in error message when invalid arguments
     are given.  Fix argument parsing of -mode option
   - StorageConsistencyCheck:  Fixed reading of STDIN
   - InspectPhedexLogs: Fixed problem of ignored date options.  Fixed
     bug in histogram printout.  Started parsing of validate failures
     for errors without details.

* Changes in PhEDEx 2.5.3.3
	
Bug fixes	
   - Fix status checking in ftscp script to handle Finished FTS state
New tools
   - Utilities/StorageConsistencyCheck and
     Utilities/BlockConsistencyCheck for comparisons against TMDB
	
* Changes in PhEDEx 2.5.3.2
	
Bug fixes
   - Fix exit code of ftscp to handle Finished FTS state
   - Fixes to FileRouter to stop dead path build up
Dependencies
   - dbs_client 1_0_5
   - dls 1_0_1
	
* Changes in PhEDEx 2.5.3

 General changes:
   - Updates to ftscp script to support new FTS2.0 states and to support 
     multiple end points, currently via static map file.
   - Updated FileDownload to reflect changes in ftscp
   - Updated FileRemove to not activate blocks 
   - Updated InspectPhedexLog 
   - Added InvariantMonitor to central agents to detect problems and 
     inconsistencies in the database 
   - Improved reporting from UtilsDB
   - Reduced number of database connections in DBSCheck
   
 Web site changes:
   - Not released in RPMs. Added Data Manager to the site

 Schema changes:
   - Changes necessary for the updates to the website
    - Removal of site/user information - now stored in SiteDB
 
* Changes in PhEDEx 2.5.2

 General changes:
   - Prevent expiration of tasks in queue, for well working links.
     Definition of well working: More than 1 MB/s on average.
   - Partial fix to the memory leak in FileDownload (reduced leakage).
   - Fixed an issue with partial paths being left over in TMDB.
   - Improved argument checking for backends.
   - Preparation for proper FTS backend, that allows per file tracking.
     Full implementation scheduled for 2.5.3.
   - PerfMonitor now can handle already compressed data, when compressing.
   - TMDBInject will ignore T0 when called via CERN-SE. Injection into T0
     will be done by providing the node name explicitly.
   - BlockDLSUpdate can now handle DBS-2.
   - Improved FileExporter config in template files.
   - Documenation updates for some agents.

 Web site changes:
   - Not released in RPMs.

 Schema changes:
   - Improved agent feed-back to TMDB.


* Changes in PhEDEx 2.5.1

 General changes:
   - BlockDLSUpdate now supports block de-registration in DLS.
   - Infrastructure agents now make the system more reactive to dead links
     and sites recovering from previous errors.
   - Corrected some issues with the template configuration files.
       - FileDownloadDelete retruns proper exit code.
       - Prevent the Glite environment from overwriting the proxy location.
       - FileDownloadVerify supports now DPM via dpns-ls.
   - TestInstallation script updated to support version 2.5.x.
   - Bug fixes in FileExporter and PerfMonitor.
   - Reduce DB load caused by FileRemove agents.

 Web site changes:

   - Not released in RPMs.

 Schema changes:
   - Prevent close loops between FilePump and FileIssue agents.
   - Update table privilege settings.


* Changes in PhEDEx 2.5.0.1

 General changes:

   - Correct -accept agent option handling.
   - Stop BlockDelete from being chatty.
   - Improvements to template config files.
   - Removal of obsolete scripts and templates.

 Web site changes:

   - Not released in RPMs.

 Schema changes:

   - Combine all site registrations to a single script.
   - Relax constraints on identities.
   - Update table privilege settings.


* Changes in PhEDEx 2.5.0

The changes for this release are too numerous to list them in great
detail. Hence, what follows is a brief overview of the main features
and improvements.

 General changes:

   - Transfer workflow optimized, so that sites need to run less agents.
     Most sites will only need three agents:
     FileDownload, FileRemove and FileExport.
   - Individual agents can run and complete tasks for multiple sites.
   - New agent work scheduling leading to:
        - Reduced DB load.
	- Reduced amount of parallel DB connections.
	- Agent shutdown doesn't interrupt running transfers and allows
	  draining of task queue.
   - Improved fair share taking into account link performance and
     preventing starving of slower links.
   - Logs of failed transfers accessible via web page.
   - Transfer prioritization.
   - Only one cool-off with reduced cycle time. No resetting needed
     anymore.
   - PhEDEx now keeps record of the SE names for each node.
   - BlockDLSUpdate can run centrally for multiple sites.
   - Subscriptions now possible for full datasets and individual blocks.
   - Improved robustness of agent communication with TMDB preventing
     agents from blocking each other.
   - PhEDEx now benefits from running on a DB cluster.
   - Tools for automatic synchronization with DBS.
	
 Web site changes:

   - Subscription allocation, modification and deletion via web page
     for site administrators authenticated by grid certificates.
   - Improved status and summary web pages, including better plotting.
   - New sites can now sign up via the web site.
   - Various improvements concerning the layout of the web interface
     (e.g positioning of scroll-bars, etc).
	
 Schema changes:

   - General performance improvements by adding indexes and partitioning
     tables.
   - Improved data consistency by adding constraints to most of the columns.
   - t_xfer_* tables changed to reflect new transfer status tracking by
     avoiding updating of tables in order to prevent DB locks.
   - Re-organized status tables t_history_* and t_status_* and put
     them in a separate module.
   - Improved performance of OracleStatsUpdate.
   - Rename administrative tables t_node and t_link* to t_adm_*.
	
	
* Changes in PhEDEx 2.4.2

 General changes:
   - Corrected FileDeleteTMDB deletion of local files.
   - DropLoadBalance updated; the agent did not work at all.

 Web site changes:
  - Corrected "interesting rows" selection on replica pages.
  - Subscription page now points to replica page.

 Schema changes:
  - TNS service names updated to allow use of streaming extensions
    required by database applications other than PhEDEx.  PhEDEx
    service definitions enable TCP keep-alive option for improved
    detection of lost database connections.


* Changes in PhEDEx 2.4.1

 General changes:
  - BlockDLSUpdate now accepts an ASCII txt list as option to '-se',
    containing pairs of nodes and storage elements. The old form of
    one '-node' and one '-se' ist still supported.
  - FileDeleteTMDB is now allowing sites to delete replicas from their
    site. Detailed instructions can be found in README-DeleteReplica.txt.
  - FileRouter now supresses multihop transfers.
	
 Web site changes:
  - Website was rewritten.
  - Extended documentation on how to setup the PhEDEx web service can be
    found in Documentation/Webconfig.

 Schema changes: none.


* Changes in PhEDEx 2.4.0

 General changes:
  - New BlockDLSUpdate agent to add fully transferred blocks to DLS.
    Please see README-Deployment.txt for configuration details.
  - FileCastorStager.New allows an option to throttle back stage-in to
    avoid Castor overload.  Use option "-protect" with an external
    script to detect overload.
  - FileDeleteTMDB updated to work also by blocks, to accept wildcards
    for node names, to remove files from the storage and to show more
    progress feedback.  The script now acquires required locks to
    protect data integrity.
  - Default site configuration templates (Custom/Template) updated.
  - Minor bug fixes to the SRM stager agent, daily report generation
    and block monitoring and deactivation agents.
  - T0FeedTest testbed to generate and feed large file samples.

 Web site changes: none.

 Schema changes:
  - tnsnames.ora updated to include other CMS databases.


* Changes in PhEDEx 2.3.12

 General changes:
  - DropTDMBPublisher -node option is now optional.  If the agent is
    started without the option and default node to inject files to,
    the drops will be required to have a non-empty PhEDEx-Nodes.txt.
    This prevents production system malfunction from registering
    files for a wrong node in TMDB by accident.
  - FileRouter now routes for nodes running just export agents but no
    download agents.  This allows site to participate as a source.
  - New FileDeleteTMDB for removing replicas and files from TMDB.
    Includes many features from Brian Bockelman's retransfer tools.

 Web site changes:
  - PHP scripts now hard code TTF font file path to avoid issues when
    the AFS web site is automatically recreated from CVS.

* Changes in PhEDEx 2.3.11

 General changes:
  - Added documentation to run in the LCG VOBOX environment.
  - Obsolete DropMTCCPublisher updated from last used version.
  - DropTMDBPublisher now takes "Options.txt" in the drop, which
    can include "strict", "!strict", "verbose", "!verbose" options
    to TMDBInject.  DropTMDBPublisher now requires the file data
    file name to end in .xml (previously .xml and .txt).
  - TMDBInject now adds the DLS attribute for a DBS.
  - FileRouter routing threshold increased from 1 TB to 5 TB.
    The transfer expire time is now automatically extended by two
    hours on links performing well enough.  That is, the transfers
    expire at the set limit only if there is no recent progress.
  - Added a missing table name alias in BlockActivate.
  - NodeNew now only creates new nodes.  New NodeRemove.
  - LinkNew, LinkRemove are new tools to administer links.

 Web site changes:
  - Preliminary work on updated transfer request handling.
  - Infrastructure for future web site changes.
  - Better coexistence of multiple schema versions.
  - Cumulative transfer plots match better transfer rate page.
  - Considerably reduced memory usage in the PHP scripts.
  - Bugs fixed for TTF font handling for newer web servers.

 Schema changes:
  - t_dps_dbs table now includes DLS contact as well.
  - Preliminary work on updated transfer requests (t_req_*).
  - Preliminary work on administrative tables (t_adm_*).
  - Various typo and interference fixes in *.sql files.

* Changes in PhEDEx 2.3.10

 General changes:
  - Various bug fixes and improvements to dCache migration agent.
  - Download agent now records the error message printed into the
    logs ("alert:" line) to the transfer state table, so remote
    sites can see the details of why files are in error states.
  - File router now requires a live download agent at destination
    and a live export agent at source to consider a link usable.
  - File router now routes files by earliest estimated time of
    arrival, aka "dynamic routing".  The time estimates are based
    on recent transfer rate performance.
  - Performance monitor now guarantees "closed" link performance
    statistics: for links with previous non-null statistics, a
    row of null performance data is inserted to guarantee a drop
    to "unused" state.  Also if there are no pending traffic on
    a link, transfer rate is reset to null (as opposed to zero).

 Web site changes:
  - State detail and transfer rate page allow node selection.
  - The transfer states are now shown as names instead of numbers.
  - Plot pages show one plot at a time and plot names are better.
  - PHP scripts doing plots now consume massively less memory.
  - Transfer state detail page now offers a link to files in each
    state combination.  For files in transfer this shows the UTC
    time of the transfer start, and for files in error states, up
    to 4000 characters of the (last) full error message as printed
    to the download agent logs at the destination site.

 Schema changes:
  - t_xfer_state adds column 'last_error' for the first 4000
    characters of the last error message (if any).
  - sqlplus login script sets variable substitution character to ':'.

* Changes in PhEDEx 2.3.9

 General changes:
  - Further improvements to the site configuration template.  There
    are now better defaults and much more extensive documentation.
  - Continued bug fixes and tuning for time-out handling.  Agents
    now remember which subprocesses they have timed out to ensure
    they really have the intended grace time to exit.
  - Agents now redirect input from /dev/null instead of closing it.
  - DropTMDBPublisher updated for TMDBInject changes.
  - File router no longer accesses t_link_param as a part of the
    migration to the new link performance estimates.  Previously
    failed transfers are given slightly more time each subsequent
    time (8-12 hours instead of previous 8 hours transfer time).
  - FTS transfers no longer abort on "Hold" status.  Spurious status
    will lead to cancelling the job so we don't leave behind junk.

 Web site changes:
  - Rate monitoring page now reports estimated link rate and latency.
  - Tier-2 workshop documents added to the list of documents.
  - PHP scripts given even more memory.

 Schema changes:
  - Updated Oracle server details.
  - A trigger now removes matching file request when a new replica is
    created.  This should avoid the race condition between router and
    recycler where we deleted both the file request and file replica.
  - t_link_param recreated with values for estimated link performance.
  - t_link_histogram now records then-current link parameters.

* Changes in PhEDEx 2.3.8

 General changes:
  - Considerably improved site configuration template.
  - Database handling changes:
    - Try harder to detect dead / unusable database connections.
    - When LogSQL is "on", print null values nicely.
  - Download agent changes:
    - Post-transfer deletes on failed transfer weren't working; fixed.
    - Timed out transfers now get 30 seconds to exit per signal sent.
  - Improvements to a configuration using pure SRM interface:
    - Download verification script trusts the exit code from the copy.
      The checking of download success using SRM was too expensive.
      Now also passes certificate proxy options to the srm-* commands.
    - Deletion script only deletes after failed transfer, no longer
      before every transfer as the latter was too expensive and post
      failure handling was considered good enough.  Now also passes
      certificate proxy options to the srm-* commands.
    - Migration agent rewritten.
    - Improvements to the stage-in agent.
    - Main export agent provided.
  - TestCatalogue did not correctly verify PFN-to-LFN, corrected.

 Web site changes:
  - Status browser updated for hosted with cmsdoc + mod_perl.  The
    transfer rate table now shows only one time span at a time.  Fixed
    the quoting of magic characters (<, >, etc.) in database report.
  - Various tweaks to the plots to better lay out the legend.
  - The legend in transfer queue page is now corrected to include only
    the items actually included in the plot.
  - The PHP plotting scripts are now hosted on cmsdoc.cern.ch.
  - Instructions for hosting the web site.

 Schema changes:
  - t_authorisation.role_name and t_info_agent_status.agent extended.
  - Performance data (t_*_histogram) older than about two days is now
    automatically compacted to time seris in 1-hour bins; newer data
    remains in the current 5-minute bins.

* Changes in PhEDEx 2.3.7

 General changes:
  - Template site configuration updated.
  - Download agent now defaults to 30 concurrent jobs.
  - Better handling of subprocesses on download agent exit.
  - File router and monitoring tweaked not to slow each other down.
  - Ftscp now handles timeout cancellation (= signal handling) and
    sleeps longer time as the download takes time.  The final FTS
    transfer status is now dumped to the output, i.e. PhEDEx logs.
    Ftscp ignores up to five glite-* server side errors to avoid
    death by intermittent glite server side database connection
    pooling problems.

 Web site change:
  - Rate page now allows source and/or destination to be filtered.
  - CERN network plots removed from the rate page.
  - Minor HTML improvements here and there.
  - Plots no longer have a black frame.

 Schema changes:
  - Nodes now have a new column 'kind' for administrative purposes.

* Changes in PhEDEx 2.3.6

 General changes:
  - Various improvements to ftscp.
  - Preliminary SRM-only agents for stage-in and tape migration.
  - Job manager changes for Castor stager agent: subprocess output
    receives "log" prefixing now only if explicitly requested.
  - Derek's catalogue test tool, slightly adapted.

 Web site change:
  - PHP scripts allowed more memory so link stats can be plotted.

 Schema changes: none.

* Changes in PhEDEx 2.3.5

 General changes:
  - Correction in handling -ignore/-accept options.  If a wildcard
    was used, not all matching nodes were filtered.
  - Download agent applies the -ignore/-accept option also when
    marking files wanted.  This makes no functional difference,
    but more correct.

 Schema changes: none.

* Changes in PhEDEx 2.3.4

 General changes:
  - Download agent improvements:
    - Log files are now prefixed by agent "boot time" so logs
      from different runs of the agent remain separate.
    - Globus backend got same logging improvements as SRM previously.

  - Block management agents:
    - Suspended blocks are now reactivated correctly if the suspend
      time (time_suspend_until) is reset to null, as opposed to just
      expiring.

  - Minor improvements to the status web browser.
    - The browser plots are now by destination by default, by link
      was too much information for default overall situation.  By
      link display is still recommended when filter for a site as
      it shows in one view all incoming and outgoing transfers.
    - Plot legend font size shrinks if many sites are included.
    - Remove rare warnings in daily stats generation.

 Schema changes:
  - INT2R TNS entries adjusted.
  - Further review of indexes.
  - t_xfer_replica authorisations corrected.
  - Certain tables are now partitioned by node.  The partitions are
    automatically added and removed by triggers on insert to or
    delete from t_node.

* Changes in PhEDEx 2.3.3

 General changes:
  - Download agent improvements:
    - The agent now uses from_node to determine to_pfn so the trivial
      file catalogue can offer different destination PFNs based on
      the source site using "destination-match".  This now reflects
      export side better: both download source and destination use a
      compatible convention.
    - Error logging has changed.  The log file for a failed transfer
      is now mentioned in the file transfer failure alert, not in a
      separate message.  The -validate etc. utility commands log the
      output directly to the main agent log, not separate log files.
      The agent now removes logs older than three days when the agent
      is idle (was 15 minutes of idle time).  The log for the transfer
      command now includes the full command line and the exit code.
      The log file prefixing scheme should no longer lose newlines.
    - Subprocess queue is no longer overfilled.  This should reduce
      the number of instances of time_transfer > timeout setting; the
      still runs only for the timeout period, the rest is queue wait.
    - Stopping the agent now correctly runs transfer validation.

  - File routing improvements:
    - The agent now routes only for nodes which have recently ran a
      download agent.  This prevents creation of routes for sites
      which are down, and therefore excessive transfer expiration.
    - File routing requests are now removed if the underlying dataset
      subscription has been suspended or removed.
    - Idle transfer requests with no file request are now removed.
      This prevents unnecessary transfers when routing changes, and
      automatically removes transfers when subscription is suspended.
    - If a file has already reached the destination, then removed,
      routes are now recreated automatically.  (See schema changes.)
    - Prevent race conditions with new file injection and routing.

  - Minor improvements to the status web browser.
    - Faster loading transfer rate page.
    - Transfer rate sorts by more values for better ordering.
    - Plot of pending transfer queue is now correct.

 Schema changes:
  - Additional trigger to reinsert transfer requests for removed replicas.
  - Corrected time in trigger to insert transfer requests for new files.
  - File routing tables enforce access only at CERN.

* Changes in PhEDEx 2.3.2

 General changes:
  - Update of "ftscp".
  - Download agent errors with -ignore/-accept options fixed.
  - Master now supports "kill" option, and can "renice" agents.
  - Database deadlocks with download/export agents should now be solved.
  - Improvements and minor fixes in the file routing algorithms.
  - Many performance optimisations and streamlining in various agents.
    Anything involving node filters (-nodes, -ignore, -accept) was
    reimplemented to be more database performance friendly.
  - Minor updates to the web pages and plots.
  - Some new tests have been included.

 Schema changes:
  - Database index review.  Many indexes have been added and removed.
  - t_dps_block_dest has a new 'state' column.
  - New trigger tr_xfer_file_insert, which inserts files for active
    block destinations automatically into t_xfer_request.
  - t_info_* tables now have constraints.
